API側は不変です。
チャットUIは今は仮のものを使っていますが、本当は services/avatar-ui をUIとして使いたいのです。

### やりたいこと

services/avatar-ui は Gemini を使っています。Gemini と会話しつつ、最終的に会話内容を構造化されたデータとして確定させて、それを MiniRAG に登録したいのです。
今はサンプルとしてダミーデータを登録していますが、会話を構造化したデータで保存したいということです。

さらに、services/avatar-ui の Gemini と会話しつつ、過去の会話内容を聞かれたら MiniRAG の検索機能を呼び出して コンテキストだけ(回答内容は不要) Gemini に渡して会話を継続したいです。
services/avatar-ui にボタン追加が必要かは分かりません。
まずは Plan を作成してほしいのですが、意味が分からなければ質問してください。



- 変更は services/avatar-ui のみで良いです
- 会話内容は私の日記です。登録したいのは、その日のあったことの重要度 (1-10、LLMが一般的にみて特異性がどの程度あったかで判断)、日記サマリー、Geminiとやり取りした全文、セマンティック記憶、エピソード記憶、メタデータ(内容はあなたが考えてください)です。
これらのデータを登録するには Geminiと会話 → 会話が終了した判定 → Gemini が会話内容を分析(重要度をつけたりエピソード記憶やセマンティック記憶を抽出したり) → MiniRAG に構造化データを登録 というフローをたどる必要があります。
services/avatar-ui はあくまでもGeminiを使った会話しかできないので諸々の改修が必要ですね。
- 会話が終了した判定 はボタンにしてください。私がボタンをクリックします。
- 検索の発火条件 は Gemini に自律的に判断させたいです。また検索のON/OFFはトグルで設定したいです。
-  Gemini への渡し方は 本文、doc_id、サマリーで、上位3件（3は設定可能）です
- workspace は 固定



- services/avatar-ui に渡すコンテキストは、ユーザー入力の本文です。MiniRAGで検索した結果 Gemini に渡すコンテキストは  doc_id / summary / body の上位N件（デフォルト3）                                                      
- workspace名：diary
- EPIC/Feature ID は上記の案でOK


# =========================================
あなたは担当機能の実装エージェントです。

【機能名】avatar-ui の改修
【指示書】services/avatar-ui/issues/ISSUE-AVATAR-001-001.md
【ドキュメント】
  - README.md
  - docs/onboarding.md
  - harness/AI-Agent-progress.txt
【やること】
  1. README.mdを確認する
  2. onboarding.mdを確認する
  3. AI-Agent-progress.txtを確認する
  4. tasks.md を読み、最大限効率化しながら優先度順にタスクを実行してください。
# =========================================
プロファイリング機能を追加したいです。

仕様：
会話が確定して日記が登録されるたびに、Gemini がユーザーの価値観、思考傾向、言葉遣いなどを分析し、プロファイリングデータを更新する。
更新対象は services/avatar-ui/profiling/user_profile.yaml で、項目は固定です。
会話内容を分析して構造化するのと同じように、Gemini が会話からプロファイル更新用データを作成する必要があります。分析対象はユーザーの入力だけで良いです。

この機能を追加するためのPlanを作成してください。
意味が分からなければ質問してください