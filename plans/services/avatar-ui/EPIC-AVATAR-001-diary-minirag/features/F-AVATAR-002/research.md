# Research: F-AVATAR-002

## Decision 1: プロファイルは差分更新で適用し、非空値は空で上書きしない

**Rationale**: LLM の出力は欠落が起きやすく、全体再生成では情報損失のリスクが高い。差分更新なら既存の非空値を保持できる。

**Alternatives considered**:

- 全体再生成で上書き: 欠落や誤りで既存値を失うリスクが高い。
- 完全手動更新: 自動化要件を満たせない。

## Decision 2: LLM 出力は YAML 全体ではなく JSON の差分形式にする

**Rationale**: JSON の差分形式は検証と適用がしやすく、固定項目の検査や空上書き防止を実装しやすい。

**Alternatives considered**:

- YAML 全体出力: 破損時に回復が難しく、差分適用ができない。
- フリーテキスト出力: 構造化が困難で適用の信頼性が低い。

## Decision 3: 分析対象はユーザー発話のみとする

**Rationale**: プロファイルはユーザーの情報を抽出するため、アシスタント発話を混ぜると誤推定が増える。

**Alternatives considered**:

- 全発話（ユーザー + アシスタント）: アシスタントの文体が混入する可能性がある。
