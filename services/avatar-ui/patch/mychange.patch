diff --git a/docs/decisions.md b/docs/decisions.md
index cffa6d750eb54e466ba805e961e60d4177ca4538..24592f5bbd70a7f268de9810c0eb60f6298ab3fb 100644
--- a/docs/decisions.md
+++ b/docs/decisions.md
@@ -27,25 +27,33 @@ Each entry should follow this format:
     - plans/system/EPIC-SYS-001-foundation.md (Decision Log)
 
 - ID: DEC-2025-002
   Date: 2025-01-01
   Scope: multi-service
   Related epics: EPIC-USER-001-ONBOARDING
   Summary: Implement user onboarding flow via api-gateway and user-service with an HTTP-based integration.
   Details: See ExecPlan at:
     - plans/services/user-service/EPIC-USER-001-onboarding.md (Decision Log)
 
 - ID: DEC-2026-001
   Date: 2026-01-02
   Scope: service:api-gateway
   Related epics: EPIC-API-002-MINIRAG
   Summary: Require MINIRAG_DB_DSN for persistent storage and allow in-memory only when explicitly enabled.
   Details: See ExecPlan at:
     - plans/services/api-gateway/EPIC-API-002-minirag/exec-plan.md (Decision Log)
 
 - ID: DEC-2026-002
   Date: 2026-01-03
   Scope: service:avatar-ui
   Related epics: EPIC-AVATAR-001-DIARY-MINIRAG
   Summary: Finalize diary conversations via explicit UI action and register structured entries to MiniRAG with fixed workspace "diary".
   Details: See ExecPlan at:
     - plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/exec-plan.md (Decision Log)
+
+- ID: DEC-2026-003
+  Date: 2026-01-03
+  Scope: service:avatar-ui
+  Related epics: EPIC-AVATAR-001-DIARY-MINIRAG
+  Summary: Persist search toggle/top_k per thread on the server and distribute defaults via /agui/config for tool + UI alignment.
+  Details: See ExecPlan at:
+    - plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/exec-plan.md (Decision Log)
diff --git a/harness/AI-Agent-progress.txt b/harness/AI-Agent-progress.txt
index 937df3f89ca508cc710c8a989f863e5e10a35871..24368a8f0d991c76ab2a1db7eb33e134f4f65d1f 100644
--- a/harness/AI-Agent-progress.txt
+++ b/harness/AI-Agent-progress.txt
@@ -70,25 +70,26 @@ target: plans/services/frontend/EPIC-API-001-minirag-demo-ui/features/F-API-003/
 [2026-01-02 06:15Z] spec quality check: PASSED
 target: plans/services/frontend/EPIC-API-001-minirag-demo-ui/features/F-API-003/checklists/requirements.md
 [2026-01-02] F-API-003 validate_spec PASSED after spec/contract alignment updates.
 [2026-01-02 06:18Z] spec quality check: PASSED
 target: plans/services/api-gateway/EPIC-API-002-minirag/features/F-API-002/checklists/requirements.md
 [2026-01-02 06:18Z] plan quality check: PASSED
 target: plans/services/api-gateway/EPIC-API-002-minirag/features/F-API-002/checklists/PlanQualityGate.md
 [2026-01-02] F-API-002 validate_spec/validate_plan PASSED after tasks.md creation.
 [2026-01-02 06:45Z] spec quality check: PASSED
 target: plans/services/api-gateway/EPIC-API-002-minirag/features/F-API-002/checklists/requirements.md
 [2026-01-02] F-API-002 spec/tasks ã®MEDIUMæŒ‡æ‘˜å¯¾å¿œï¼ˆLLMæ˜è¨˜/æ€§èƒ½ãƒ»ä¾å­˜éšœå®³ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼‰
 2026-01-02T09:17:44Z | implementation-agent | EPIC-API-001-MINIRAG-DEMO-UI | F-API-003 | Added static MiniRAG demo UI, puppeteer E2E scenario, and updated scripts/README.
 2026-01-02T09:18:43Z | codex | EPIC-API-002-MINIRAG | F-API-002 | api-gateway ã« MiniRAG API/ãƒªãƒã‚¸ãƒˆãƒª/ã‚¹ã‚­ãƒ¼ãƒ/ãƒ†ã‚¹ãƒˆ/E2E/ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ ã€‚æ¤œè¨¼ã¯æœªå®Ÿè¡Œã€‚
 2026-01-02T12:56:25Z | codex | EPIC-API-002-MINIRAG | F-API-002 | scripts/run_all_unit_tests.sh PASSED (5 tests).
 2026-01-02T14:04:00Z | codex | EPIC-API-002-MINIRAG | F-API-002 | Docker Postgres(AGE/pgvector) èµ·å‹•ã€MINIRAG API èµ·å‹•å¾Œã« scripts/run_all_e2e_tests.sh PASSEDã€‚
 2026-01-03T09:20:06Z | codex | EPIC-AVATAR-001-DIARY-MINIRAG | F-AVATAR-001 | avatar-ui æ—¥è¨˜/MiniRAGé€£æºã®ä»•æ§˜ãƒ»è¨­è¨ˆæˆæœç‰©ã‚’è¿½åŠ ã—ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ–‡æ›¸ã‚’æ›´æ–°ã€‚
 [2026-01-03 09:20Z] spec quality check: PASSED
 target: plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/features/F-AVATAR-001/checklists/requirements.md
 [2026-01-03 09:20Z] plan quality check: PASSED
 target: plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/features/F-AVATAR-001/checklists/PlanQualityGate.md
 [2026-01-03 11:24Z] spec quality check: PASSED
 target: plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/features/F-AVATAR-001/checklists/requirements.md
 [2026-01-03 11:24Z] plan quality check: PASSED
 target: plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/features/F-AVATAR-001/checklists/PlanQualityGate.md
 2026-01-03T11:25:50Z | codex | EPIC-AVATAR-001-DIARY-MINIRAG | F-AVATAR-001 | tasks.md ã‚’ç”Ÿæˆï¼ˆavatar-ui æ—¥è¨˜æ§‹é€ åŒ– + MiniRAG é€£æºï¼‰ã€‚
+2026-01-03T11:52:13Z | implementation-agent | EPIC-AVATAR-001-DIARY-MINIRAG | F-AVATAR-001 | Implemented MiniRAG diary finalize/search endpoints, UI controls, and settings defaults for avatar-ui.
diff --git a/harness/feature_list.json b/harness/feature_list.json
index 3d51120c9ce989fd7f509b05057bb61cd615520f..cd84bbfbc7d05a19ccfcc3bb76e51eeb9366b2b8 100644
--- a/harness/feature_list.json
+++ b/harness/feature_list.json
@@ -79,51 +79,51 @@
       "services": ["api-gateway"],
       "status": "failing",
       "tags": ["backend", "rag", "data-search"],
 
       "spec_path": "plans/services/api-gateway/EPIC-API-002-minirag/features/F-API-002/spec.md",
       "checklist_path": "plans/services/api-gateway/EPIC-API-002-minirag/features/F-API-002/checklists/requirements.md"
     },
     {
       "id": "F-API-003",
       "epic_id": "EPIC-API-001-MINIRAG-DEMO-UI",
       "title": "MiniRAG demo chat UI",
       "description": "Static HTML/JS demo UI to register/search/delete sample data.",
       "services": ["frontend", "api-gateway"],
       "status": "passing",
       "tags": ["frontend", "demo-ui"],
 
       "spec_path": "plans/services/frontend/EPIC-API-001-minirag-demo-ui/features/F-API-003/spec.md",
       "checklist_path": "plans/services/frontend/EPIC-API-001-minirag-demo-ui/features/F-API-003/checklists/requirements.md"
     },
     {
       "id": "F-AVATAR-001",
       "epic_id": "EPIC-AVATAR-001-DIARY-MINIRAG",
       "title": "Diary conversation structuring + MiniRAG search integration",
       "description": "Gemini conversations are finalized into structured diary entries and stored in MiniRAG; Gemini can retrieve past diary context on demand.",
       "services": ["avatar-ui", "api-gateway"],
-      "status": "failing",
+      "status": "passing",
       "tags": ["frontend", "agent", "rag"],
 
       "spec_path": "plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/features/F-AVATAR-001/spec.md",
       "checklist_path": "plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/features/F-AVATAR-001/checklists/requirements.md"
     },
     {
       "id": "F-USER-001",
       "epic_id": "EPIC-USER-001-ONBOARDING",
       "title": "Signup page basic UI",
       "description": "User can open /signup and see the signup form.",
       "services": ["api-gateway"],
       "status": "failing",
       "tags": ["frontend", "user-flow"],
 
       "spec_path": "plans/services/user-service/EPIC-USER-001-onboarding/features/F-USER-001/spec.md",
       "checklist_path": "plans/services/user-service/EPIC-USER-001-onboarding/features/F-USER-001/checklists/requirements.md"
     },
     {
       "id": "F-USER-002",
       "epic_id": "EPIC-USER-001-ONBOARDING",
       "title": "Signup API endpoint",
       "description": "POST /api/users creates a user and returns 201.",
       "services": ["api-gateway", "user-service"],
       "status": "failing",
       "tags": ["backend", "api"],
diff --git a/plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/exec-plan.md b/plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/exec-plan.md
index 881ac0a4813993218842ffdd832b3379117317d0..dd11b416fed6d76551e975fcf616e35ba8892f25 100644
--- a/plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/exec-plan.md
+++ b/plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/exec-plan.md
@@ -1,79 +1,85 @@
 # EPIC-AVATAR-001-DIARY-MINIRAG: æ—¥è¨˜ä¼šè©±ã®æ§‹é€ åŒ–ã¨MiniRAGé€£æº
 
 This ExecPlan is a living document. The sections `Progress`, `Surprises & Discoveries`, `Decision Log`, and `Outcomes & Retrospective` must be kept up to date as work proceeds.
 
 This repository stores the ExecPlan guidelines in `./PLANS.md` at the repository root. This document must be maintained in accordance with PLANS.md.
 
 This epic has an epic-level design index at `plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/design/index.md`. It contains a feature map, shared entities, API/contract references, and the cross-feature flow summary for this epic. The ExecPlan remains self-contained and repeats the critical context below.
 
 ## Purpose / Big Picture
 
 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ avatar-ui ã§ Gemini ã¨æ—¥è¨˜ä¼šè©±ã‚’è¡Œã„ã€ä¼šè©±çµ‚äº†æ™‚ã«ãƒœã‚¿ãƒ³æ“ä½œã§ä¼šè©±å†…å®¹ã‚’æ§‹é€ åŒ–ã—ã€MiniRAG ã«ç™»éŒ²ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã•ã‚‰ã«ã€Gemini ã¯å¿…è¦æ™‚ã« MiniRAG æ¤œç´¢ã‚’è‡ªå¾‹çš„ã«å‘¼ã³å‡ºã—ã€éå»æ—¥è¨˜ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆdoc_id / summary / bodyï¼‰ã ã‘ã‚’å—ã‘å–ã£ã¦ä¼šè©±ã‚’ç¶™ç¶šã§ãã¾ã™ã€‚UI ã«ã¯æ¤œç´¢ã® ON/OFF ãƒˆã‚°ãƒ«ã¨ top_k è¨­å®šãŒè¡¨ç¤ºã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸»å°ã§ä½“é¨“ã‚’åˆ¶å¾¡ã§ãã‚‹ã“ã¨ãŒå¯è¦–åŒ–ã•ã‚Œã¾ã™ã€‚
 
 ## Related Features / Specs
 
 - F-AVATAR-001: æ—¥è¨˜ä¼šè©±ã®æ§‹é€ åŒ–ç™»éŒ²ã¨MiniRAGæ¤œç´¢é€£æº
   - Spec: `plans/services/avatar-ui/EPIC-AVATAR-001-diary-minirag/features/F-AVATAR-001/spec.md`
-  - Status: planned
+  - Status: implemented
 
 ## Progress
 
 - [x] (2026-01-03 09:13Z) Epic ã®åˆæœŸ ExecPlan ã¨è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆéª¨å­ã‚’ä½œæˆã—ãŸã€‚
 - [x] (2026-01-03 09:20Z) Spec / Impl Plan / Research / Data Model / Contracts / Quickstart ã‚’æ•´å‚™ã—ã€å“è³ªã‚²ãƒ¼ãƒˆã‚’ PASS ã«ã—ãŸã€‚
 - [x] (2026-01-03 09:20Z) avatar-ui ã®ã‚µãƒ¼ãƒ“ã‚¹è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ã€è¨ˆç”»ã¨ã®å·®åˆ†ã‚’è§£æ¶ˆã—ãŸã€‚
-- [ ] (2026-01-03 09:13Z) å®Ÿè£…æº–å‚™ã¨ã—ã¦ã‚¿ã‚¹ã‚¯åˆ†è§£ã‚’å®Œäº†ã—ã€Jules Issue ä½œæˆã¸ç§»è¡Œã™ã‚‹ã€‚
+- [x] (2026-01-03 09:20Z) å®Ÿè£…æº–å‚™ã¨ã—ã¦ã‚¿ã‚¹ã‚¯åˆ†è§£ã‚’å®Œäº†ã—ã€Jules Issue ä½œæˆã¸ç§»è¡Œã—ãŸã€‚
+- [x] (2026-01-03 12:20Z) MiniRAG ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨æ—¥è¨˜ç¢ºå®š API ã‚’å®Ÿè£…ã—ã€UI ã«æ¤œç´¢ãƒˆã‚°ãƒ«ã¨ä¼šè©±ç¢ºå®šã‚’è¿½åŠ ã—ãŸã€‚
+- [x] (2026-01-03 12:20Z) settings.json5 ã¨ README ã‚’æ›´æ–°ã—ã€æ—¥è¨˜ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨è¨­å®šé …ç›®ã‚’åæ˜ ã—ãŸã€‚
 
 ## Surprises & Discoveries
 
 - Observation:
 
   Spec ã¨ Plan ã®å“è³ªã‚²ãƒ¼ãƒˆã¯æ–°è¦ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã«å¯¾ã—ã¦ PASSED ã¨ãªã£ãŸã€‚
 
   Evidence:
 
     [2026-01-03 09:20Z] spec quality check: PASSED
 
     [2026-01-03 09:20Z] plan quality check: PASSED
 
 ## Decision Log
 
 - Decision: ä¼šè©±çµ‚äº†ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒœã‚¿ãƒ³æ“ä½œã§ç¢ºå®šã—ã€ç¢ºå®šæ™‚ã« Gemini ãŒä¼šè©±ã‚’åˆ†æã—ã¦é‡è¦åº¦ãƒ»ã‚µãƒãƒªãƒ¼ãƒ»ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯è¨˜æ†¶ãƒ»ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶ã‚’ç”Ÿæˆã™ã‚‹ã€‚
   Rationale: æ—¥è¨˜ç”¨é€”ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã€Œã“ã“ã¾ã§ã€ã‚’æ˜ç¤ºã§ãã‚‹ UX ãŒå¿…è¦ã§ã‚ã‚Šã€è‡ªå‹•çµ‚äº†åˆ¤å®šã‚ˆã‚Šèª¤ç™»éŒ²ã‚’æ¸›ã‚‰ã›ã‚‹ãŸã‚ã€‚
   Date/Author: 2026-01-03 / codex
 
 - Decision: MiniRAG ã®æ¤œç´¢ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¯ doc_id / summary / body ã®ä¸Šä½Nä»¶ã®ã¿ã‚’ Gemini ã«æ¸¡ã™ã€‚
   Rationale: å›ç­”ãã®ã‚‚ã®ã§ã¯ãªãæ–‡è„ˆã ã‘ã‚’æ¸¡ã™ã“ã¨ã§ã€Gemini ãŒä¼šè©±ã‚’ç¶™ç¶šã—ã‚„ã™ãã€éå‰°ãªæƒ…å ±æ³¨å…¥ã‚’é¿ã‘ã‚‰ã‚Œã‚‹ãŸã‚ã€‚
   Date/Author: 2026-01-03 / codex
 
 - Decision: workspace ã¯å›ºå®šå€¤ `diary` ã¨ã—ã€UI ã§å¤‰æ›´ã—ãªã„ã€‚
   Rationale: å€‹äººæ—¥è¨˜ç”¨é€”ã§é‹ç”¨ãŒå˜ç´”åŒ–ã§ãã€æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ã‚‚æ˜ç¢ºã«ãªã‚‹ãŸã‚ã€‚
   Date/Author: 2026-01-03 / codex
 
+- Decision: æ¤œç´¢ãƒˆã‚°ãƒ«ã¨ top_k è¨­å®šã¯ server å´ã§ã‚¹ãƒ¬ãƒƒãƒ‰ã”ã¨ã«ä¿æŒã—ã€UI åˆæœŸå€¤ã¯ `/agui/config` ã‹ã‚‰é…å¸ƒã™ã‚‹ã€‚
+  Rationale: UI ã¨æ¤œç´¢ãƒ„ãƒ¼ãƒ«ãŒåŒã˜è¨­å®šã‚½ãƒ¼ã‚¹ã‚’å‚ç…§ã§ãã€Gemini ã®ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã¨ UX ã®æ•´åˆæ€§ã‚’ä¿ã¦ã‚‹ãŸã‚ã€‚
+  Date/Author: 2026-01-03 / codex
+
 ## Outcomes & Retrospective
 
-ã“ã®æ™‚ç‚¹ã§ã¯è¨ˆç”»ã®ã¿ä½œæˆæ¸ˆã¿ã€‚å®Ÿè£…ã¯æœªç€æ‰‹ã€‚
+UI ã¸ã®æ¤œç´¢ãƒˆã‚°ãƒ«ãƒ»top_kãƒ»ä¼šè©±ç¢ºå®šãƒœã‚¿ãƒ³è¿½åŠ ã¨ã€FastAPI å´ã® MiniRAG é€£æº API ã‚’å®Ÿè£…ã—ãŸã€‚search_diary ãƒ„ãƒ¼ãƒ«çµŒç”±ã§ Gemini ãŒéå»æ—¥è¨˜æ¤œç´¢ã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚Šã€ä¼šè©±ç¢ºå®šã®çµæœãŒ UI ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€‚
 
 ## Context and Orientation
 
 ã“ã®ã‚¨ãƒ”ãƒƒã‚¯ã¯ avatar-ui ã®ã¿ã‚’å¤‰æ›´å¯¾è±¡ã¨ã—ã€MiniRAG API ã¯æ—¢å­˜ã® api-gateway å´ã‚’åˆ©ç”¨ã™ã‚‹å‰æã§ã™ã€‚avatar-ui ã«ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ`services/avatar-ui/app/`ï¼‰ã¨ FastAPI ãƒ™ãƒ¼ã‚¹ã® AG-UI ã‚µãƒ¼ãƒãƒ¼ï¼ˆ`services/avatar-ui/server/`ï¼‰ãŒã‚ã‚Šã€UI ã¯ `/agui` ã«æ¥ç¶šã—ã¦ Gemini ã¨ã®ä¼šè©±ã‚’è¡Œã„ã¾ã™ã€‚æœ¬æ©Ÿèƒ½ã§ã¯ UI ã«ã€Œæ¤œç´¢ãƒˆã‚°ãƒ«ã€ã€Œtop_k è¨­å®šã€ã€Œä¼šè©±ç¢ºå®šãƒœã‚¿ãƒ³ã€ã‚’è¿½åŠ ã—ã€ã‚µãƒ¼ãƒãƒ¼å´ã« MiniRAG å‘¼ã³å‡ºã—ã¨ä¼šè©±æ§‹é€ åŒ–ã®ãƒ•ãƒ­ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚
 
 é‡è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚
 
 - UI: `services/avatar-ui/app/src/renderer/index.html`, `services/avatar-ui/app/src/renderer/main.ts`, `services/avatar-ui/app/src/renderer/style.css`
 - ã‚µãƒ¼ãƒãƒ¼: `services/avatar-ui/server/main.py`, `services/avatar-ui/server/src/config.py`
 - è¨­å®š: `services/avatar-ui/settings.json5`, `.env`ï¼ˆãŸã ã—æœ¬è¨ˆç”»ã§ã¯ `.env` ã‚’ç·¨é›†ã—ãªã„ï¼‰
 
 ç”¨èª:
 
 - ä¼šè©±ç¢ºå®š: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€Œæ—¥è¨˜ã®åŒºåˆ‡ã‚Šã€ã‚’å®£è¨€ã™ã‚‹æ“ä½œã€‚
 - ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯è¨˜æ†¶: æ—¥è¨˜ã®ä¸­ã«å«ã¾ã‚Œã‚‹æ’ä¹…çš„ãªçŸ¥è­˜ãƒ»ç¿’æ…£ãƒ»ä¾¡å€¤è¦³ã€‚
 - ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶: æ—¥è¨˜ã®ä¸­ã®å…·ä½“çš„ãªå‡ºæ¥äº‹ã‚„ä½“é¨“ã€‚
 - æ¤œç´¢ãƒˆã‚°ãƒ«: MiniRAG æ¤œç´¢ã®ä½¿ç”¨å¯å¦ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ UI ã‚¹ã‚¤ãƒƒãƒã€‚
 
 ## Plan of Work
 
 ã¾ãšã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ–‡æ›¸ã¨ avatar-ui ã®ã‚µãƒ¼ãƒ“ã‚¹è¨­è¨ˆã‚’æ›´æ–°ã—ã€MiniRAG é€£æºãŒã‚·ã‚¹ãƒ†ãƒ ã®ã©ã“ã«ä½ç½®ã¥ãã‹ã‚’æ˜ç¢ºåŒ–ã™ã‚‹ã€‚æ¬¡ã«ã€F-AVATAR-001 ã®ä»•æ§˜ãƒ»è¨­è¨ˆæˆæœç‰©ã‚’æ•´å‚™ã—ã€MiniRAG ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã¨ UI/ã‚µãƒ¼ãƒãƒ¼ã®è²¬å‹™åˆ†æ‹…ã‚’ç¢ºå®šã™ã‚‹ã€‚æœ€å¾Œã«ã€å®Ÿè£…ã®ãŸã‚ã®å…·ä½“çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ã¨å¤‰æ›´å†…å®¹ã‚’ Impl Plan ã«è¨˜è¼‰ã—ã€å“è³ªã‚²ãƒ¼ãƒˆã‚’é€šéã•ã›ã‚‹ã€‚
 
 ## Concrete Steps
 
 1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ–‡æ›¸ã®æ›´æ–°
diff --git a/services/avatar-ui/README.ja.md b/services/avatar-ui/README.ja.md
index 63853f9f8170b403e0f5b77a2b7fbc7dd3f436fd..bea133a52a303c2913b46a50c0e6538b182d2849 100644
--- a/services/avatar-ui/README.ja.md
+++ b/services/avatar-ui/README.ja.md
@@ -13,50 +13,51 @@ Geminiãƒ»GPTãƒ»Claude å¯¾å¿œã€‚ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§å‹•ãã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ UI
 ![demo](./docs/assets/avatar-ui_demo_02.gif)
 
 ## ç‰¹å¾´
 
 - **ãƒãƒ«ãƒLLMå¯¾å¿œ** â€“ Gemini / OpenAI / Anthropic ã‚’è¨­å®šã§åˆ‡ã‚Šæ›¿ãˆ
 - **ãƒ„ãƒ¼ãƒ«æ‹¡å¼µå¯¾å¿œ** â€“ æ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ¨™æº–æ­è¼‰ã€‚MCPé€£æºãƒ»ãƒ„ãƒ¼ãƒ«è¿½åŠ å¯
 - **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºUI** â€“ 3ç¨®ã®ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã€‚ã‚¢ãƒã‚¿ãƒ¼å¤‰æ›´ã‚‚è‡ªç”±
 - **ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒª** â€“ ãƒ­ãƒ¼ã‚«ãƒ«å‹•ä½œã€‚macOS / Windows / Linux å¯¾å¿œ
 - **å•†ç”¨åˆ©ç”¨å¯** â€“ ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ï¼ˆMITï¼‰ã€‚å€‹äººãƒ»å•†ç”¨å•ã‚ãšè‡ªç”±ã«åˆ©ç”¨å¯èƒ½
 - **æ—¥è¨˜ + MiniRAG é€£æº** â€“ ä¼šè©±ç¢ºå®šãƒœã‚¿ãƒ³ã§æ—¥è¨˜ã‚’æ§‹é€ åŒ–ã— MiniRAG ã«ç™»éŒ²ã€å¿…è¦æ™‚ã«éå»æ—¥è¨˜ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
 
 ## ä½¿ã„æ–¹
 
 1. ã‚¢ãƒ—ãƒªèµ·å‹• â†’ ã‚¢ãƒã‚¿ãƒ¼ãŒå¾…æ©ŸçŠ¶æ…‹ã§è¡¨ç¤º
 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ› â†’ `Enter` ã§é€ä¿¡
 3. ã‚¢ãƒã‚¿ãƒ¼ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¿œç­”
 4. å¿…è¦ã«å¿œã˜ã¦ Google æ¤œç´¢ã‚’è‡ªå‹•å®Ÿè¡Œ
 5. çµ‚äº†ï¼š`Ctrl+C`
 
 ## æ—¥è¨˜ + MiniRAG é€£æºï¼ˆæ¦‚è¦ï¼‰
 
 - UI ã«ã€Œæ¤œç´¢ãƒˆã‚°ãƒ«ã€ã€Œtop_k è¨­å®šã€ã€Œä¼šè©±ç¢ºå®šãƒœã‚¿ãƒ³ã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
 - ä¼šè©±ç¢ºå®šãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€Gemini ãŒä¼šè©±å†…å®¹ã‚’åˆ†æã—ã€é‡è¦åº¦ãƒ»ã‚µãƒãƒªãƒ¼ãƒ»è¨˜æ†¶ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
 - æŠ½å‡ºçµæœã¯ MiniRAG ã«æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¾ã™ã€‚
 - æ¤œç´¢ãƒˆã‚°ãƒ« ON ã®ã¨ãã®ã¿ã€Gemini ãŒ MiniRAG æ¤œç´¢ã§éå»æ—¥è¨˜ã‚’å‚ç…§ã—ã¾ã™ã€‚
+- top_k ã¨æ¤œç´¢ãƒˆã‚°ãƒ«ã®åˆæœŸå€¤ã¯ `settings.json5` ã® `minirag` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§èª¿æ•´ã§ãã¾ã™ã€‚
 
 ## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ
 
 ## DeepAgentsSpec ã§ã®é…ç½®
 
 ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ã€`services/avatar-ui/` ã«é…ç½®æ¸ˆã¿ã§ã™ã€‚
 ä»¥ä¸‹ã¯ã“ã®æ§‹æˆã«åˆã‚ã›ãŸæœ€å°æ‰‹é †ã§ã™ã€‚
 
 ### 1. ç’°å¢ƒå¤‰æ•°ã‚’ç”¨æ„ï¼ˆå¿…é ˆï¼‰
 
 `services/avatar-ui/` ç›´ä¸‹ã« `.env` ã‚’ä½œæˆã—ã€å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚
 ä¸»ãªå¿…é ˆé …ç›®ã¯ä»¥ä¸‹ã§ã™ï¼ˆå€¤ã¯ã‚ãªãŸã®ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šï¼‰:
 
 - `GOOGLE_API_KEY`ï¼ˆæ¤œç´¢ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ã†å ´åˆï¼‰
 - `AGENT_ID`
 - `THREAD_ID`
 - `SERVER_HOST`
 - `SERVER_BIND_HOST`ï¼ˆä»»æ„ã€WSL ãªã©ã§ 0.0.0.0 ãƒã‚¤ãƒ³ãƒ‰ã—ãŸã„å ´åˆï¼‰
 - `SERVER_PORT`
 - `CLIENT_PORT`
 - `APP_ENV`
 - `SESSION_TIMEOUT_SECONDS`
 - `CLEANUP_INTERVAL_SECONDS`
 
 > æ³¨æ„: ç¾è¡Œã®ã‚µãƒ¼ãƒãƒ¼å®Ÿè£…ã¯ `GOOGLE_API_KEY` ãŒæœªè¨­å®šã ã¨èµ·å‹•æ™‚ã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚
@@ -189,50 +190,63 @@ cp settings.default.json5 settings.json5
 
 ### LLM ã®åˆ‡ã‚Šæ›¿ãˆ
 
 ```json5
 "server": {
   "llmProvider": "gemini",       // gemini | openai | anthropic
   "llmModel": "gemini-2.5-flash"
 }
 ```
 
 å¯¾å¿œã™ã‚‹ API ã‚­ãƒ¼ã‚’ `.env` ã«è¨­å®šã—ã€ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚
 
 ### æ¤œç´¢ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
 
 ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ Google æ¤œç´¢ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæœ‰åŠ¹ã§ã™ï¼ˆGemini ãƒ¢ãƒ‡ãƒ«ã§å‹•ä½œï¼‰ã€‚  
 ç„¡åŠ¹åŒ–ã™ã‚‹å ´åˆ:
 
 ```json5
 "searchSubAgent": {
   "enabled": false
 }
 ```
 
 æ¤œç´¢ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ Gemini API ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€åˆ©ç”¨ã«ã¯ `GOOGLE_API_KEY` ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚
 
+### æ—¥è¨˜ + MiniRAG è¨­å®š
+
+`settings.json5` ã® `minirag` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€MiniRAG ã®æ¥ç¶šå…ˆã¨ UI ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã§ãã¾ã™ã€‚
+
+```json5
+minirag: {
+  baseUrl: "http://localhost:8165",
+  workspace: "diary",
+  searchEnabledDefault: true,
+  topKDefault: 3,
+}
+```
+
 ### ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¸€è¦§
 
 | é …ç›® | è¨­å®šå ´æ‰€ |
 |------|----------|
 | ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ | `settings.json5` â†’ `server.systemPrompt` |
 | ãƒ†ãƒ¼ãƒãƒ»è‰² | `settings.json5` â†’ `ui.theme`, `ui.themes` |
 | ã‚¢ãƒã‚¿ãƒ¼ç”»åƒ | `app/src/renderer/assets/` ã«é…ç½® |
 | ãƒ„ãƒ¼ãƒ«è¿½åŠ  | `server/main.py` â†’ `tools` ãƒªã‚¹ãƒˆ |
 
 ## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
 
 - [è¨­è¨ˆæ›¸](./docs/project.md) â€“ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€å®Ÿè£…è©³ç´°ã€ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
 - [AG-UI Protocol](https://docs.ag-ui.com/) â€“ ãƒ—ãƒ­ãƒˆã‚³ãƒ«ä»•æ§˜ï¼ˆå…¬å¼ï¼‰
 - [Google ADK](https://google.github.io/adk-docs/) â€“ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–‹ç™ºã‚­ãƒƒãƒˆï¼ˆå…¬å¼ï¼‰
 
 ## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
 
 [MIT License](LICENSE)
 
 Â© 2025 [SIQI](https://siqi.jp) (Sito Sikino)
 
 ## ãƒ¡ãƒ¢
 
 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆVite/ãƒ–ãƒ©ã‚¦ã‚¶ï¼‰ã¨ Pythonï¼ˆFastAPIï¼‰ã¯ã€ãã‚Œãã‚Œåˆ¥ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦åŒæ™‚ã«èµ·å‹•ã—ã¦ã„ã¾ã™ã€‚  
 `services/avatar-ui/scripts/run_dev.sh` ã¯ã€ã¾ãš Python ã‚µãƒ¼ãƒãƒ¼ï¼ˆFastAPIï¼‰ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•ã—ã€æ¬¡ã« Viteï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰ã‚’ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•ã—ã¾ã™ã€‚
diff --git a/services/avatar-ui/app/src/renderer/config.ts b/services/avatar-ui/app/src/renderer/config.ts
index 3b381d59c55cd2cb2f6a563cd6bb6f90996b3b06..4ef2a1fadba911040ec4550d23c6978c8c61651d 100644
--- a/services/avatar-ui/app/src/renderer/config.ts
+++ b/services/avatar-ui/app/src/renderer/config.ts
@@ -14,64 +14,74 @@ export interface UiConfig {
   mouthInterval: number;
   beepFrequency: number;
   beepDuration: number;
   beepVolumeEnd: number;
   avatarOverlayOpacity?: number;
   avatarBrightness?: number;
   glowText?: number;
   glowBox?: number;
   brightness?: number;
   nameTags: {
     user: string;
     avatar: string;
     avatarFullName: string;
   };
   systemMessages: {
     banner1: string;
     banner2: string;
   };
 }
 
 // ã‚¢ãƒ—ãƒªå…¨ä½“ã®è¨­å®šï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ»UI ã‚’çµ±åˆï¼‰
 export interface AppConfig {
   server: {
     url: string;
   };
+  minirag: {
+    workspace: string;
+    searchEnabledDefault: boolean;
+    topKDefault: number;
+  };
   agent: {
     url: string;
     agentId: string;
     threadId: string;
   };
   clientLogVerbose: boolean;
   ui: UiConfig;
 }
 
 // åˆæœŸçŠ¶æ…‹ (æœªãƒ­ãƒ¼ãƒ‰æ™‚ã«ä½¿ã†ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤)
 const defaults: AppConfig = {
   server: {
     url: "", // ãƒ—ãƒ­ã‚­ã‚·ä½¿ç”¨ (/agui/config)
   },
+  minirag: {
+    workspace: "diary",
+    searchEnabledDefault: true,
+    topKDefault: 3,
+  },
   agent: {
     url: "",
     agentId: "",
     threadId: "",
   },
   clientLogVerbose: false,
   ui: {
     themeColor: "#33ff99",    // UI ã®åŸºèª¿è‰²
     userColor: "#64ffff",     // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è‰²
     toolColor: "#ffaa00",     // ãƒ„ãƒ¼ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è‰²
     typeSpeed: 0,             // 0=å³æ™‚æç”»
     opacity: 0.7,             // ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒãƒ«ã®é€æ˜åº¦
     soundVolume: 0,           // åŠ¹æœéŸ³ãƒœãƒªãƒ¥ãƒ¼ãƒ åˆæœŸå€¤
     mouthInterval: 0,         // ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯é–“éš”åˆæœŸå€¤
     beepFrequency: 0,         // ãƒ“ãƒ¼ãƒ—å‘¨æ³¢æ•°åˆæœŸå€¤
     beepDuration: 0,          // ãƒ“ãƒ¼ãƒ—é•·ã•åˆæœŸå€¤
     beepVolumeEnd: 0,         // ãƒ“ãƒ¼ãƒ—çµ‚äº†æ™‚éŸ³é‡åˆæœŸå€¤
     nameTags: {
       user: "",               // è¡¨ç¤ºå: ãƒ¦ãƒ¼ã‚¶ãƒ¼
       avatar: "",             // è¡¨ç¤ºå: ã‚¢ãƒã‚¿ãƒ¼
       avatarFullName: "",     // è¡¨ç¤ºå: ãƒ•ãƒ«ãƒãƒ¼ãƒ 
     },
     systemMessages: {
       banner1: "",            // ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸1
       banner2: "",            // ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸2
@@ -82,46 +92,53 @@ const defaults: AppConfig = {
 // ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³: ã‚¢ãƒ—ãƒªå…¨ä½“ã§å…±æœ‰ã™ã‚‹è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 export let config: AppConfig = { ...defaults };
 
 export interface FetchConfigOptions {
   /** è¨­å®šå–å¾—ã«å¤±æ•—ã—ã¦ã‚‚ console.error ã‚’å‡ºã•ãªã„ï¼ˆãƒªãƒˆãƒ©ã‚¤å¾…æ©Ÿç”¨ï¼‰ */
   silent?: boolean;
 }
 
 /**
  * ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¨­å®šã‚’å–å¾—ã—ã€config ã‚’æ›´æ–°ã™ã‚‹
  * @throws å–å¾—å¤±æ•—æ™‚ã¯ä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼ã—ã€å‘¼ã³å‡ºã—å…ƒã§ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’è¡Œã†
  */
 export async function fetchConfig(options: FetchConfigOptions = {}): Promise<void> {
   try {
     // dev: /agui/config (Vite proxy) / prod: http://127.0.0.1:8000/agui/config
     const base = typeof __AGUI_BASE__ !== "undefined" ? __AGUI_BASE__ : "";
     const response = await fetch(`${base}/agui/config`);
     if (!response.ok) {
       throw new Error(`Config fetch failed: ${response.status} ${response.statusText}`);
     }
     const serverConfig = await response.json();
 
     // æ–°å½¢å¼: { ui, clientLogVerbose, agent }, æ—§å½¢å¼: uiã®ã¿
     const ui = serverConfig.ui ?? serverConfig;
     const agent = serverConfig.agent ?? defaults.agent;
+    const minirag = serverConfig.minirag ?? defaults.minirag;
     config.ui = ui;
     const agentUrl = agent.url ?? `${base}/agui`;
     config.agent = {
       url: agentUrl,
       agentId: agent.agentId ?? "",
       threadId: agent.threadId ?? "",
     };
+    config.minirag = {
+      workspace: minirag.workspace ?? defaults.minirag.workspace,
+      searchEnabledDefault: Boolean(minirag.searchEnabledDefault ?? defaults.minirag.searchEnabledDefault),
+      topKDefault: Number(minirag.topKDefault ?? defaults.minirag.topKDefault),
+    };
     config.clientLogVerbose = Boolean(serverConfig.clientLogVerbose ?? false);
 
 	    console.info("Config loaded from server:", {
 	      ui: config.ui,
+	      minirag: config.minirag,
 	      agent: config.agent,
 	      clientLogVerbose: config.clientLogVerbose,
 	    });
 	  } catch (error) {
 	    if (!options.silent) {
 	      console.error("Failed to load config from server:", error);
 	    }
 	    throw error; // Mainå´ã§ã‚­ãƒ£ãƒƒãƒã—ã¦ã‚¨ãƒ©ãƒ¼ç”»é¢ã‚’è¡¨ç¤º
 	  }
 }
diff --git a/services/avatar-ui/app/src/renderer/index.html b/services/avatar-ui/app/src/renderer/index.html
index 8ce121dc9cdc92645f5c3de4bfb459e97c07f346..0a21eee7e5d1fd4b1105a881b7c487a68f81aea8 100644
--- a/services/avatar-ui/app/src/renderer/index.html
+++ b/services/avatar-ui/app/src/renderer/index.html
@@ -1,50 +1,64 @@
 <!-- ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šç¾©ï¼ˆå‡ºåŠ›ãƒ»å…¥åŠ›ãƒ»ã‚¢ãƒã‚¿ãƒ¼ã®3ãƒšã‚¤ãƒ³ï¼‰ -->
 <!doctype html>
 <html lang="ja">
   <head>
     <meta charset="utf-8" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0" />
     <!-- é–‹ç™ºç”¨ã« localhost ã¸ã®æ¥ç¶šã‚’è¨±å¯ã™ã‚‹ CSP -->
     <meta
       http-equiv="Content-Security-Policy"
       content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: https:; media-src 'self' data: blob: https:; connect-src 'self' http://localhost:* http://127.0.0.1:* https: ws: wss:;"
     />
     <title>Avatar UI</title>
     <link rel="stylesheet" href="./style.css" />
   </head>
   <body>
     <main class="app split">
       <section data-slot="output" id="pane-output">
         <div class="surface-host" id="surface-host">
           <div class="surface surface--text">
             <div class="text-scroll" id="output"></div>
           </div>
         </div>
       </section>
 
       <footer data-slot="input" id="pane-input">
-        <span class="prompt">&gt;</span>
-        <input type="text" id="input" autofocus />
+        <div class="diary-controls">
+          <label class="toggle">
+            <input type="checkbox" id="search-toggle" />
+            <span>æ¤œç´¢</span>
+          </label>
+          <label class="top-k">
+            top_k
+            <input type="number" id="search-top-k" min="1" max="10" step="1" />
+          </label>
+          <button type="button" id="finalize-button">ä¼šè©±ç¢ºå®š</button>
+          <span class="finalize-status" id="finalize-status"></span>
+        </div>
+        <div class="input-row">
+          <span class="prompt">&gt;</span>
+          <input type="text" id="input" autofocus />
+        </div>
       </footer>
 
       <aside data-slot="avatar" id="pane-avatar">
         <div id="avatar-wrap">
           <!-- ã‚¢ãƒã‚¿ãƒ¼ç”»åƒï¼ˆidle/talk ã‚’ data å±æ€§ã§æŒã¡æ›¿ãˆï¼‰ -->
           <img
             id="avatar-img"
             src="./idle.png"
             data-idle="./idle.png"
             data-talk="./talk.png"
             alt="avatar"
           />
         </div>
         <div id="avatar-label" class="avatar-label">Spectra</div>
       </aside>
 
       <!-- ç”»é¢ä¸‹éƒ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤ºï¼ˆmain.ts ã§ package.json ã‹ã‚‰ä¸Šæ›¸ãï¼‰ -->
       <div class="meta-bar" id="meta">avatar-ui</div>
     </main>
 
     <script type="module" src="./main.ts"></script>
   </body>
 </html>
diff --git a/services/avatar-ui/app/src/renderer/main.ts b/services/avatar-ui/app/src/renderer/main.ts
index f6b7aee2982c1589c119bff21a5c124bb2faa3f9..6fbdb786d8b65a01899179becbdb7e64bef4e7b6 100644
--- a/services/avatar-ui/app/src/renderer/main.ts
+++ b/services/avatar-ui/app/src/renderer/main.ts
@@ -1,43 +1,55 @@
 // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®ãƒ¡ã‚¤ãƒ³å‡¦ç†: è¨­å®šèª­ã¿è¾¼ã¿ãƒ»UIåˆæœŸåŒ–ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œã‚’ã¾ã¨ã‚ã‚‹
 import { config, fetchConfig } from "./config";
 import { createAgent } from "../core/agent";
 import { loggerSubscriber } from "../core/loggerSubscriber";
 import { createUiSubscriber, renderMarkdown } from "./subscriber";
 import { TerminalEngine } from "./engine/TerminalEngine";
 import { createAutoScrollController } from "./autoScroll";
 import pkg from "../../package.json"; // ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®å–å¾—
 
 // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä¿æŒã™ã‚‹
 let agentInstance = null as ReturnType<typeof createAgent> | null;
 
 // UI è¦ç´ ã¸ã®å‚ç…§ã‚’ç¢ºä¿
 const inputEl = document.getElementById("input") as HTMLInputElement | null;
 const outputEl = document.querySelector("#pane-output .text-scroll") as HTMLElement | null;
 const avatarImg = document.getElementById("avatar-img") as HTMLImageElement | null;
 const metaBar = document.getElementById("meta");
 const avatarLabel = document.getElementById("avatar-label");
+const searchToggle = document.getElementById("search-toggle") as HTMLInputElement | null;
+const topKInput = document.getElementById("search-top-k") as HTMLInputElement | null;
+const finalizeButton = document.getElementById("finalize-button") as HTMLButtonElement | null;
+const finalizeStatus = document.getElementById("finalize-status") as HTMLSpanElement | null;
+
+type DiaryMessage = {
+  role: "user" | "assistant" | "system";
+  content: string;
+  created_at?: string;
+};
+
+const transcript: DiaryMessage[] = [];
 
 async function initApp() {
   if (!inputEl || !outputEl || !avatarImg || !avatarLabel) {
     throw new Error("UI elements missing");
   }
 
   // ãƒ¡ã‚¿ãƒãƒ¼ã¯ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå + ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆpackage.json ç”±æ¥ï¼‰
   if (metaBar) {
     metaBar.textContent = `${pkg.name} v${pkg.version}`;
   }
 
   // 1. ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¨­å®šã‚’å–å¾—ï¼ˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•å‰ã§ã‚‚è½ã¨ã•ãšã«å¾…æ©Ÿï¼‰
   inputEl.disabled = true;
   outputEl.textContent = "";
   {
     const line = document.createElement("div");
     line.className = "text-line text-line--system";
     line.textContent = "> Starting server...";
     outputEl.appendChild(line);
   }
 
   const sleep = (ms: number) => new Promise<void>(resolve => setTimeout(resolve, ms));
   let retryDelayMs = 250;
   while (true) {
     try {
@@ -121,102 +133,227 @@ async function initApp() {
   if (config.ui.glowText !== undefined) {
     root.style.setProperty("--glow-text-alpha1", String(0.6 * config.ui.glowText)); // å¼·ã‚ã®ã‚°ãƒ­ãƒ¼ä¿‚æ•°
     root.style.setProperty("--glow-text-alpha2", String(0.4 * config.ui.glowText)); // å¼±ã‚ã®ã‚°ãƒ­ãƒ¼ä¿‚æ•°
   }
   if (config.ui.glowBox !== undefined) {
     root.style.setProperty("--glow-box-alpha1", String(0.4 * config.ui.glowBox)); // å¤–æ ã®å¼·ã‚ã‚°ãƒ­ãƒ¼ä¿‚æ•°
     root.style.setProperty("--glow-box-alpha2", String(0.2 * config.ui.glowBox)); // å¤–æ ã®å¼±ã‚ã‚°ãƒ­ãƒ¼ä¿‚æ•°
   }
   if (config.ui.brightness !== undefined) {
     root.style.setProperty("--ui-brightness", String(config.ui.brightness));
   }
 
   // 3. UIã‚¨ãƒ³ã‚¸ãƒ³ (Game Loop) ã®åˆæœŸåŒ–
   // ã“ã‚Œã²ã¨ã¤ã§ã‚¿ã‚¤ãƒ—ãƒ©ã‚¤ã‚¿ãƒ¼ãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»éŸ³å£°ã™ã¹ã¦ã‚’åˆ¶å¾¡ã™ã‚‹
   const autoScroll = createAutoScrollController(outputEl);
   const engine = new TerminalEngine(outputEl, avatarImg, renderMarkdown, autoScroll);
 
   // 4. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆæœŸåŒ–ï¼ˆã‚µãƒ¼ãƒè¨­å®šã«å¾“ã†ï¼‰
   agentInstance = createAgent({
     agentId: config.agent.agentId,
     url: config.agent.url,
     threadId: config.agent.threadId,
   });
   agentInstance.subscribe(loggerSubscriber);
 
+  const serverBase = config.agent.url.replace(/\/agui\/?$/, "");
+  const diaryWorkspace = config.minirag.workspace;
+  const diarySearchSettings = {
+    enabled: config.minirag.searchEnabledDefault,
+    top_k: config.minirag.topKDefault,
+  };
+
   // ãƒ†ã‚­ã‚¹ãƒˆè¡Œã‚’è¿½åŠ ï¼ˆã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä»‹ã•ãªã„å³æ™‚è¡¨ç¤ºç”¨ï¼‰
   const appendLine = (className: string, text: string) => {
     const line = document.createElement("div");
     line.className = `text-line ${className}`;
     line.textContent = text;
     outputEl.appendChild(line);
     outputEl.scrollTop = outputEl.scrollHeight;
   };
 
   let isRunning = false; // å¤šé‡å®Ÿè¡Œé˜²æ­¢ãƒ•ãƒ©ã‚°
+  let isFinalizing = false;
+
+  const updateFinalizeStatus = (text: string, isError = false) => {
+    if (!finalizeStatus) return;
+    finalizeStatus.textContent = text;
+    finalizeStatus.style.color = isError ? "rgba(255, 102, 102, 1)" : "";
+  };
+
+  const applySearchSettings = async () => {
+    if (!config.agent.threadId) {
+      return;
+    }
+    try {
+      const response = await fetch(`${serverBase}/agui/diary/search-settings`, {
+        method: "POST",
+        headers: { "Content-Type": "application/json" },
+        body: JSON.stringify({
+          thread_id: config.agent.threadId,
+          settings: diarySearchSettings,
+        }),
+      });
+      if (!response.ok) {
+        throw new Error(`Search settings update failed: ${response.status}`);
+      }
+      updateFinalizeStatus("æ¤œç´¢è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸ");
+    } catch (error) {
+      updateFinalizeStatus(
+        `æ¤œç´¢è¨­å®šã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error instanceof Error ? error.message : String(error)}`,
+        true,
+      );
+    }
+  };
+
+  if (searchToggle) {
+    searchToggle.checked = diarySearchSettings.enabled;
+    searchToggle.addEventListener("change", async () => {
+      diarySearchSettings.enabled = searchToggle.checked;
+      await applySearchSettings();
+    });
+  }
+
+  if (topKInput) {
+    topKInput.value = String(diarySearchSettings.top_k);
+    topKInput.addEventListener("change", async () => {
+      const value = Number(topKInput.value);
+      diarySearchSettings.top_k = Number.isNaN(value)
+        ? config.minirag.topKDefault
+        : Math.min(Math.max(value, 1), 10);
+      topKInput.value = String(diarySearchSettings.top_k);
+      await applySearchSettings();
+    });
+  }
+
+  if (searchToggle || topKInput) {
+    await applySearchSettings();
+  }
 
   // ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’å‡¦ç†ã—ã¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«é€ä¿¡
   inputEl.addEventListener("keydown", async (event) => {
     if (event.isComposing || event.key !== "Enter") {
       return;
     }
     event.preventDefault();
 
     if (isRunning) {
       return;
     }
 
     const value = inputEl.value.trim();
     if (!value) {
       return;
     }
 
     // ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®è¡¨ç¤º: è¨­å®šã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚°ã‚’ä½¿ã†
     const userTag = config.ui.nameTags.user ? `${config.ui.nameTags.user}> ` : "> ";
     appendLine("text-line--user", `${userTag}${value}`);
     inputEl.value = "";
 
     const userMessage = {
       id: crypto.randomUUID(),
       role: "user" as const,
       content: value,
     };
 
     agentInstance!.messages.push(userMessage);
+    transcript.push({
+      role: "user",
+      content: value,
+      created_at: new Date().toISOString(),
+    });
 
     isRunning = true;
     try {
       await agentInstance!.runAgent(
         {
           runId: crypto.randomUUID(),
         },
         createUiSubscriber({
           outputEl,
           engine, // ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ¸¡ã™
           autoScroll,
+          onAssistantMessageComplete: (message) => {
+            transcript.push({
+              role: "assistant",
+              content: message,
+              created_at: new Date().toISOString(),
+            });
+          },
         }),
       );
     } catch (error) {
       // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼ã®è¡¨ç¤º
       console.error(error);
       appendLine(
         "text-line--error",
         `âŒ ${error instanceof Error ? error.message : String(error)}`,
       );
     } finally {
       isRunning = false;
     }
   });
+
+  if (finalizeButton) {
+    finalizeButton.addEventListener("click", async () => {
+      if (isFinalizing) {
+        return;
+      }
+      if (!transcript.length) {
+        appendLine("text-line--error", "âŒ ä¼šè©±å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
+        return;
+      }
+      isFinalizing = true;
+      finalizeButton.disabled = true;
+      updateFinalizeStatus("ä¼šè©±ã‚’ç¢ºå®šã—ã¦ã„ã¾ã™...");
+      try {
+        const response = await fetch(`${serverBase}/agui/diary/finalize`, {
+          method: "POST",
+          headers: { "Content-Type": "application/json" },
+          body: JSON.stringify({
+            workspace: diaryWorkspace,
+            thread_id: config.agent.threadId,
+            messages: transcript,
+            search_settings: diarySearchSettings,
+          }),
+        });
+        if (!response.ok) {
+          const payload = await response.json().catch(() => ({}));
+          throw new Error(payload.detail || `Finalize failed: ${response.status}`);
+        }
+        const payload = await response.json();
+        appendLine(
+          "text-line--system",
+          `> æ—¥è¨˜ã‚’ç™»éŒ²ã—ã¾ã—ãŸ: ${payload.doc_id} (é‡è¦åº¦ ${payload.analysis.importance_score})`,
+        );
+        appendLine(
+          "text-line--system",
+          `> ã‚µãƒãƒªãƒ¼: ${payload.analysis.summary}`,
+        );
+        updateFinalizeStatus("ä¼šè©±ç¢ºå®šãŒå®Œäº†ã—ã¾ã—ãŸ");
+      } catch (error) {
+        appendLine(
+          "text-line--error",
+          `âŒ ä¼šè©±ç¢ºå®šã«å¤±æ•—ã—ã¾ã—ãŸ: ${error instanceof Error ? error.message : String(error)}`,
+        );
+        updateFinalizeStatus("ä¼šè©±ç¢ºå®šã«å¤±æ•—ã—ã¾ã—ãŸ", true);
+      } finally {
+        isFinalizing = false;
+        finalizeButton.disabled = false;
+      }
+    });
+  }
   
   // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: è¨­å®šã•ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½¿ã†
   const fullName = config.ui.nameTags.avatarFullName || config.ui.nameTags.avatar || "AGENT";
   if (config.ui.systemMessages.banner1) {
     const banner1 = config.ui.systemMessages.banner1.replace("{avatarFullName}", fullName);
     appendLine("text-line--system", `> ${banner1}`);
   }
   if (config.ui.systemMessages.banner2) {
     appendLine("text-line--system", `> ${config.ui.systemMessages.banner2}`);
   }
 }
 
 // ã‚¢ãƒ—ãƒªèµ·å‹•
 initApp().catch(err => console.error("Fatal Error:", err));
diff --git a/services/avatar-ui/app/src/renderer/style.css b/services/avatar-ui/app/src/renderer/style.css
index cb3175a105b574271a2ce72dbe9d05e5316c8272..b07d7bdac55a54bc280d79d5af26f86fe7cebbdf 100644
--- a/services/avatar-ui/app/src/renderer/style.css
+++ b/services/avatar-ui/app/src/renderer/style.css
@@ -203,59 +203,116 @@ body {
 .text-line--error {
   color: rgba(var(--error-color-r), var(--error-color-g), var(--error-color-b), 1);
 }
 
 /* AI ã®ææ¡ˆæ–‡ãªã©ã‚’å›²ã†ã‚¹ã‚¿ã‚¤ãƒ« */
 .text-line--proposed {
   color: var(--col-theme-text);
   font-family: Consolas, Menlo, monospace;
   background: rgba(0, 20, 10, 0.4);
   padding: 8px;
   border: 1px solid rgba(var(--theme-color-r), var(--theme-color-g), var(--theme-color-b), 0.3);
 }
 
 .text-line--user { color: var(--col-user-text); }
 .text-line--assistant { color: var(--col-theme-text); }
 .text-line--tool { 
   color: var(--col-tool-text);
   font-style: italic;
 }
 
 /* å…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆç”»é¢ä¸‹ï¼‰ */
 #pane-input {
   grid-column: 1 / 3;
   grid-row: 2 / 3;
   display: flex;
-  align-items: center;
+  flex-direction: column;
+  align-items: stretch;
   gap: 8px;
   padding: 10px 12px; /* å…¥åŠ›æ ã®ä½™ç™½ */
   border: 1px solid var(--col-border-main);
   box-shadow: var(--glow-box);
   background: var(--col-panel-bg);
   filter: brightness(var(--ui-brightness));
 }
 
+.diary-controls {
+  display: flex;
+  flex-wrap: wrap;
+  align-items: center;
+  gap: 10px;
+  font-size: 12px;
+  color: var(--col-theme-dim);
+}
+
+.diary-controls label {
+  display: inline-flex;
+  align-items: center;
+  gap: 6px;
+}
+
+.diary-controls input[type="checkbox"] {
+  accent-color: var(--col-theme-main);
+}
+
+.diary-controls input[type="number"] {
+  width: 64px;
+  background: rgba(0, 0, 0, 0.4);
+  border: 1px solid var(--col-border-main);
+  color: inherit;
+  font: inherit;
+  padding: 2px 6px;
+  border-radius: 4px;
+}
+
+#finalize-button {
+  background: rgba(var(--theme-color-r), var(--theme-color-g), var(--theme-color-b), 0.15);
+  border: 1px solid var(--col-border-high);
+  color: var(--col-theme-text);
+  font: inherit;
+  padding: 4px 10px;
+  border-radius: 4px;
+  cursor: pointer;
+  text-shadow: var(--glow-text);
+}
+
+#finalize-button:disabled {
+  opacity: 0.5;
+  cursor: not-allowed;
+}
+
+.finalize-status {
+  color: var(--col-theme-text);
+  opacity: 0.8;
+}
+
+.input-row {
+  display: flex;
+  align-items: center;
+  gap: 8px;
+}
+
 #input {
   flex: 1;
   background: transparent;
   border: none;
   color: inherit;
   font: inherit;
   outline: none;
 }
 
 /* ã‚¢ãƒã‚¿ãƒ¼ã‚¨ãƒªã‚¢ï¼ˆå³ã‚«ãƒ©ãƒ ï¼‰ */
 #pane-avatar {
   grid-column: 2 / 3;
   grid-row: 1 / 2;
   border: 1px solid var(--col-border-main);
   box-shadow: var(--glow-box);
   background: rgba(0, 40, 20, 0.25); /* æœ¬æ–‡ã‚ˆã‚Šå°‘ã—æ¿ƒã„èƒŒæ™¯ã§åŒºåˆ‡ã‚‹ */
   display: flex;
   flex-direction: column;
   align-items: center;
   justify-content: center;
   padding: 4px; /* ç”»åƒã¨ã®ä½™ç™½ã‚’ç¢ºä¿ */
   box-sizing: border-box;
   gap: 12px; /* ç”»åƒã¨ãƒ©ãƒ™ãƒ«ã®é–“éš” */
 }
 
diff --git a/services/avatar-ui/app/src/renderer/subscriber.ts b/services/avatar-ui/app/src/renderer/subscriber.ts
index b18e41350c40f155aede73525fd765bd21e7d261..bb22a53aa9e825a80fb9392e3602aafc6b9e482b 100644
--- a/services/avatar-ui/app/src/renderer/subscriber.ts
+++ b/services/avatar-ui/app/src/renderer/subscriber.ts
@@ -1,97 +1,105 @@
 // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã‚Šã€ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®è¡¨ç¤ºãƒ»éŸ³ãƒ»ãƒ­ã‚°ã‚’æ›´æ–°ã™ã‚‹è³¼èª­å‡¦ç†
 import type { AgentSubscriber } from "@ag-ui/client";
 import { TerminalEngine } from "./engine/TerminalEngine";
 import { config } from "./config";
 import { marked } from "marked";
 import DOMPurify from "dompurify";
 import type { AutoScrollController } from "./autoScroll";
 
 /**
  * Markdown â†’ ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ HTML ã¸å¤‰æ›ï¼ˆå…±é€šé–¢æ•°ï¼‰
  */
 export function renderMarkdown(md: string): string {
   let html = marked.parse(md) as string;
   // ã‚¿ã‚°é–“ãƒ»æœ«å°¾ã®ç©ºç™½ã‚’é™¤å»ï¼ˆwhite-space: pre-wrap å¯¾ç­–ï¼‰
   html = html.replace(/>\s+</g, "><").trimEnd();
   return DOMPurify.sanitize(html);
 }
 
 // UI ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼ã®åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³
 interface UiSubscriberOptions {
   outputEl: HTMLElement;  // ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›å…ˆ
   engine: TerminalEngine; // ã‚¿ã‚¤ãƒ—ãƒ©ã‚¤ã‚¿ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³
   autoScroll: AutoScrollController; // ä¸‹ç«¯è¿½å¾“ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
+  onAssistantMessageComplete?: (message: string) => void;
 }
 
 /**
  * ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­ã—ã€UI ã‚’æ›´æ–°ã™ã‚‹ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼ã‚’ç”Ÿæˆ
  */
 export function createUiSubscriber(options: UiSubscriberOptions): AgentSubscriber {
   const { outputEl, engine, autoScroll } = options;
+  const { onAssistantMessageComplete } = options;
 
   // ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—è¡¨ç¤ºç”¨ã®çŠ¶æ…‹
   let activeToolDetails: HTMLDetailsElement | null = null;
   let activeToolName = "";
   let argsBuffer = "";
+  let assistantBuffer = "";
 
   // ãƒ†ã‚­ã‚¹ãƒˆè¡Œã‚’è¿½åŠ 
   const appendLine = (className: string, text: string) => {
     const line = document.createElement("div");
     line.className = `text-line ${className}`;
     line.textContent = text;
     outputEl.appendChild(line);
     autoScroll.maybeScroll();
     return line;
   };
 
   // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰æœ€åˆã«è¦‹ã¤ã‹ã£ãŸæ–‡å­—åˆ—å€¤ã‚’å–ã‚Šå‡ºã™ï¼ˆæ±ç”¨ï¼‰
   const extractFirstString = (obj: unknown): string => {
     if (typeof obj === "string") return obj;
     if (obj && typeof obj === "object") {
       for (const v of Object.values(obj as Record<string, unknown>)) {
         if (typeof v === "string") return v;
       }
     }
     return JSON.stringify(obj, null, 2);
   };
 
   return {
     onTextMessageStartEvent() {
       // è¨­å®šã•ã‚ŒãŸã‚¢ãƒã‚¿ãƒ¼ã‚¿ã‚°ã‚’å–å¾—
       const tag = config.ui.nameTags.avatar ? `${config.ui.nameTags.avatar}> ` : "";
 
       // ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é–‹å§‹ï¼šæ–°ã—ã„è¡Œã‚’ä½œæˆã—ã¦ã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚»ãƒƒãƒˆï¼ˆã‚¿ã‚°ã¯å³æ™‚è¡¨ç¤ºï¼‰
       engine.startNewMessage("text-line text-line--assistant", tag);
+      assistantBuffer = "";
     },
     onTextMessageContentEvent({ event }) {
       // æ–‡å­—åˆ—ã‚’ã‚¨ãƒ³ã‚¸ãƒ³ã«æ¸¡ã™ï¼ˆã‚¨ãƒ³ã‚¸ãƒ³ãŒå°‘ã—ãšã¤è¡¨ç¤ºã™ã‚‹ï¼‰
       // Markdown ã¯ç¾çŠ¶ã®ã‚¨ãƒ³ã‚¸ãƒ³ã§ã¯ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã€‚ã“ã“ã¯å¾“æ¥ã©ãŠã‚Šã€‚
       engine.pushText(event.delta);
+      assistantBuffer += event.delta;
     },
     onTextMessageEndEvent() {
       // ä»Šã®ã¨ã“ã‚ç‰¹ã«ãªã— (ã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚­ãƒ¥ãƒ¼ãŒç©ºã«ãªã‚Œã°æ­¢ã¾ã‚‹)
+      if (assistantBuffer.trim() && onAssistantMessageComplete) {
+        onAssistantMessageComplete(assistantBuffer.trim());
+      }
     },
     
     // ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæŠ˜ã‚ŠãŸãŸã¿è¡¨ç¤ºï¼‰
     onToolCallStartEvent({ event }) {
       activeToolName = event.toolCallName;
       argsBuffer = "";
 
       const details = document.createElement("details");
       details.className = "tool-call text-line--tool";
 
       const summary = document.createElement("summary");
       summary.textContent = `ğŸ”§ ${event.toolCallName}...`;
       details.appendChild(summary);
 
       outputEl.appendChild(details);
       autoScroll.maybeScroll();
 
       activeToolDetails = details;
     },
     // ãƒ„ãƒ¼ãƒ«å¼•æ•°ã®æ–­ç‰‡ã‚’å—ã‘å–ã‚‹ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰
     onToolCallArgsEvent({ event }) {
       if (event.delta) {
         argsBuffer += event.delta;
       }
     },
diff --git a/services/avatar-ui/server/main.py b/services/avatar-ui/server/main.py
index 3af7cbb4920af2ca33b7a25a0260ed3dc474eca2..7139c90dd3a2d81a5bbc175604360a39482e0c31 100644
--- a/services/avatar-ui/server/main.py
+++ b/services/avatar-ui/server/main.py
@@ -1,91 +1,96 @@
 # AG-UI ã‚µãƒ¼ãƒãƒ¼ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆFastAPI + Google ADKï¼‰
 import logging
 from logging.handlers import RotatingFileHandler
 from pathlib import Path
 from fastapi import FastAPI, Request
 from fastapi.middleware.cors import CORSMiddleware
 from fastapi.responses import JSONResponse
 from ag_ui_adk import ADKAgent, add_adk_fastapi_endpoint
 from google.adk.agents import LlmAgent
 from google.adk import tools as adk_tools
 from google.adk.models.lite_llm import LiteLlm
 from google.adk.tools.agent_tool import AgentTool
 from google.adk.tools.google_search_tool import GoogleSearchTool
+from google.adk.tools import FunctionTool
 
 from src import config
+from src.routes.diary import router as diary_router, search_diary
 
 # æ¤œç´¢ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ã†å ´åˆã¯ GOOGLE_API_KEY ãŒå¿…é ˆ
 if config.SEARCH_SUBAGENT_ENABLED and not config.GOOGLE_API_KEY:
     raise RuntimeError("GOOGLE_API_KEY is not set. Please add it to .env in project root")
 
 # ---------- ãƒ­ã‚®ãƒ³ã‚°è¨­å®š ----------
 logs_dir = Path(__file__).resolve().parent / "logs"
 logs_dir.mkdir(exist_ok=True)
 log_file = logs_dir / "app.log"
 
 log_level = logging.INFO
 logging.basicConfig(
     level=log_level,
     format="%(asctime)s | %(levelname)s | %(name)s | %(message)s",
     handlers=[RotatingFileHandler(log_file, maxBytes=config.LOG_MAX_BYTES, backupCount=config.LOG_BACKUP_COUNT)],
 )
 logger = logging.getLogger("agui-adk-bridge")
 
 # ---------- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹ç¯‰ ----------
 
 def resolve_model(provider: str, model: str):
     """ãƒ—ãƒ­ãƒã‚¤ãƒ€ã«å¿œã˜ãŸãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™ï¼ˆgemini ã¯ç›´æ¥ã€ä»–ã¯ LiteLlm çµŒç”±ï¼‰"""
     provider = provider.lower()
     if provider == "gemini":
         return model
     # openai / anthropic ãªã©ã¯ LiteLlm çµŒç”±
     if "/" in model:
         return LiteLlm(model=model)
     return LiteLlm(model=f"{provider}/{model}")
 
 
 def build_agent() -> ADKAgent:
     """ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ§‹ç¯‰ï¼ˆæ¤œç´¢ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä»˜ãã®å ´åˆã‚ã‚Šï¼‰"""
-    search_tool = None
+    search_subagent_tool = None
     if config.SEARCH_SUBAGENT_ENABLED:
         search_agent = LlmAgent(
             name="search_agent",
             model=config.SEARCH_SUBAGENT_MODEL,
             description="Performs web searches using Google Search",
             instruction=(
                 "Search the web and return concise results. "
                 "Use the same language as the latest user message. Phrase the search query in that language."
             ),
             tools=[GoogleSearchTool(bypass_multi_tools_limit=True)],
         )
-        search_tool = AgentTool(agent=search_agent)
+        search_subagent_tool = AgentTool(agent=search_agent)
 
     main_model = resolve_model(config.LLM_PROVIDER, config.LLM_MODEL)
-    tools = [adk_tools.preload_memory]
-    if search_tool:
-        tools.append(search_tool)
+    tools = [
+        adk_tools.preload_memory,
+        FunctionTool(search_diary),
+    ]
+    if search_subagent_tool:
+        tools.append(search_subagent_tool)
 
     main_agent = LlmAgent(
         name="assistant",
         model=main_model,
         instruction=config.SYSTEM_PROMPT,
         tools=tools,
     )
 
     return ADKAgent(
         adk_agent=main_agent,
         app_name="agents",
         user_id="cli_user",
         use_in_memory_services=True,
         session_timeout_seconds=config.SESSION_TIMEOUT_SECONDS,
         cleanup_interval_seconds=config.CLEANUP_INTERVAL_SECONDS,
     )
 
 
 # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ã«æ§‹ç¯‰ï¼‰
 agent = build_agent()
 
 # ---------- FastAPI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ----------
 app = FastAPI(title="AG-UI ADK Bridge")
 app.add_middleware(
     CORSMiddleware,
@@ -99,55 +104,63 @@ app.add_middleware(
 @app.middleware("http")
 async def log_agui_request(request: Request, call_next):
     if request.url.path == "/agui" and request.method == "POST":
         if config.APP_ENV == "dev" or config.LOG_BODY is True:
             body = await request.body()
             logger.info("AGUI request body: %s", body.decode("utf-8", errors="replace"))
             request._body = body
     try:
         response = await call_next(request)
         return response
     except Exception as exc:
         logger.exception("Unhandled server error")
         return JSONResponse(status_code=500, content={"detail": "Internal server error"})
 
 # Config API Endpoint
 @app.get("/agui/config")
 def get_config():
     """
     UIç”¨ã®è¨­å®šã‚’è¿”ã™ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚
     Serverè¨­å®š(config.py)ã‹ã‚‰ã€UIã«å¿…è¦ãªéƒ¨åˆ†ã ã‘ã‚’æŠ½å‡ºã—ã¦è¿”ã™ã€‚
     """
     # UIè¨­å®šã«åŠ ãˆã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒ­ã‚°ã®è©³ç´°å¯å¦ãƒ•ãƒ©ã‚°ã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ¥ç¶šæƒ…å ±ã‚‚è¿”ã™
     return {
         "ui": config._ui_settings,
         "clientLogVerbose": config.CLIENT_LOG_VERBOSE,
+        "minirag": {
+            "workspace": config.MINIRAG_WORKSPACE,
+            "searchEnabledDefault": config.MINIRAG_SEARCH_ENABLED_DEFAULT,
+            "topKDefault": config.MINIRAG_TOP_K_DEFAULT,
+        },
         "agent": {
             "url": config.AGENT_URL,
             "agentId": config.AGENT_ID,
             "threadId": config.THREAD_ID,
         },
     }
 
+
+app.include_router(diary_router)
+
 # AG-UI ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç™»éŒ²
 add_adk_fastapi_endpoint(app, agent, path="/agui")
 
 # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ç­‰ã‹ã‚‰ä½¿ç”¨ï¼‰
 @app.get("/healthz")
 async def healthz():
     return {"status": "ok"}
 
 # ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ï¼ˆAPI ã®å­˜åœ¨ç¢ºèªç”¨ï¼‰
 @app.get("/")
 def root():
     return {"status": "ok", "endpoint": "/agui"}
 
 # ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã—ã¦èµ·å‹•ã™ã‚‹å ´åˆã¯ .env ã®å€¤ã§ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹
 if __name__ == "__main__":
     import uvicorn
 
     uvicorn.run(
         "main:app",
         host=config.SERVER_BIND_HOST,
         port=config.SERVER_PORT,
         reload=(config.APP_ENV == "dev"),
     )
diff --git a/services/avatar-ui/server/src/config.py b/services/avatar-ui/server/src/config.py
index 2508a53853edfe3293111d5d411477a4d1473df1..bd732981558997929469f7d2bdb9d444f9c6ba72 100644
--- a/services/avatar-ui/server/src/config.py
+++ b/services/avatar-ui/server/src/config.py
@@ -66,54 +66,63 @@ class UiSettings(BaseModel, extra="forbid"):
 
 # ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã®ãƒ—ãƒªã‚»ãƒƒãƒˆå®šç¾©
 class ThemePreset(BaseModel, extra="forbid"):
     name: str
     themeColor: str
     userColor: str
     toolColor: str
 
 
 # ã‚µãƒ¼ãƒãƒ¼å´ã®è¨­å®šï¼ˆLLM ãƒ—ãƒ­ãƒã‚¤ãƒ€ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç­‰ï¼‰
 class ServerSettings(BaseModel, extra="forbid"):
     llmProvider: str = "gemini"  # gemini | openai | anthropic
     llmModel: str
     searchSubAgent: "SearchSubAgent" = Field(default_factory=lambda: SearchSubAgent())
     systemPrompt: str
     logMaxBytes: int = Field(gt=0)
     logBackupCount: int = Field(ge=0)
 
 
 # æ¤œç´¢ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¨­å®šï¼ˆGemini + google_search ã‚’ä½¿ç”¨ï¼‰
 class SearchSubAgent(BaseModel, extra="forbid"):
     enabled: bool = True
     model: str = "gemini-2.5-flash"
 
 
+# MiniRAG é€£æºè¨­å®š
+class MiniRagSettings(BaseModel, extra="forbid"):
+    baseUrl: str
+    workspace: str = "diary"
+    searchEnabledDefault: bool = True
+    topKDefault: int = Field(ge=1, le=10, default=3)
+
+
 # settings.json5 ã®ãƒ«ãƒ¼ãƒˆã‚¹ã‚­ãƒ¼ãƒ
 class AppSettings(BaseModel, extra="forbid"):
     server: ServerSettings
     ui: UiSettings
+    minirag: MiniRagSettings
 
 
 # ---------- ãƒ†ãƒ¼ãƒè§£æ±º ----------
 
 def resolve_theme(ui: UiSettings) -> dict:
     """
     ãƒ†ãƒ¼ãƒãƒ—ãƒªã‚»ãƒƒãƒˆã‚’è§£æ±ºã—ã€å®Ÿéš›ã«ä½¿ã†è‰²ã‚’æ±ºå®šã™ã‚‹ã€‚
     - ui.theme ã§æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆãŒã‚ã‚Œã°ãã‚Œã‚’åŸºæº–ã«ã™ã‚‹
     - å€‹åˆ¥æŒ‡å®šï¼ˆthemeColor ãªã©ï¼‰ãŒã‚ã‚Œã°ãƒ—ãƒªã‚»ãƒƒãƒˆã‚ˆã‚Šå„ªå…ˆã™ã‚‹
     """
     resolved = ui.model_dump()
     if ui.themes:
         for preset in ui.themes:
             if preset.name == ui.theme:
                 resolved["themeColor"] = preset.themeColor
                 resolved["userColor"] = preset.userColor
                 resolved["toolColor"] = preset.toolColor
                 break
     resolved.pop("themes", None)
     return resolved
 
 
 # .env ã‹ã‚‰èª­ã¿è¾¼ã‚€ç’°å¢ƒå¤‰æ•°ã®ã‚¹ã‚­ãƒ¼ãƒ
 class EnvSettings(BaseSettings):
     google_api_key: str = Field(alias="GOOGLE_API_KEY")
@@ -208,27 +217,33 @@ allowed_origins_env = os.getenv("ALLOWED_ORIGINS")
 if allowed_origins_env:
     CORS_ORIGINS: List[str] = [o.strip() for o in allowed_origins_env.split(",") if o.strip()]
 else:
     CORS_ORIGINS: List[str] = [o.format(port=CLIENT_PORT) for o in DEFAULT_ALLOWED_ORIGINS_DEV]
 
 LLM_MODEL = app_settings.server.llmModel
 LLM_PROVIDER = app_settings.server.llmProvider
 SYSTEM_PROMPT = app_settings.server.systemPrompt
 LOG_MAX_BYTES = app_settings.server.logMaxBytes
 LOG_BACKUP_COUNT = app_settings.server.logBackupCount
 
 # Session/HITL è¨­å®š
 SESSION_TIMEOUT_SECONDS = env_settings.session_timeout_seconds
 CLEANUP_INTERVAL_SECONDS = env_settings.cleanup_interval_seconds
 
 # FastAPI ã® /agui/config ã§è¿”ã™ãŸã‚ã« dict ã§ä¿æŒ
 _ui_settings = resolve_theme(app_settings.ui)
 
 # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ­ã‚°è©³ç´°å¯å¦ï¼ˆã‚µãƒ¼ãƒè¨­å®šã¨é€£å‹•ï¼‰
 CLIENT_LOG_VERBOSE = (APP_ENV == "dev") or (LOG_BODY is True)
 
 # æ¤œç´¢ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®š
 SEARCH_SUBAGENT_ENABLED = app_settings.server.searchSubAgent.enabled
 SEARCH_SUBAGENT_MODEL = app_settings.server.searchSubAgent.model
 
+# MiniRAG è¨­å®š
+MINIRAG_BASE_URL = app_settings.minirag.baseUrl
+MINIRAG_WORKSPACE = app_settings.minirag.workspace
+MINIRAG_SEARCH_ENABLED_DEFAULT = app_settings.minirag.searchEnabledDefault
+MINIRAG_TOP_K_DEFAULT = app_settings.minirag.topKDefault
+
 # AG-UI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ¥ç¶šæƒ…å ±ï¼ˆã‚µãƒ¼ãƒã‚’å”¯ä¸€ã®çœŸå®Ÿæºã¨ã™ã‚‹ï¼‰
 AGENT_URL = f"http://{SERVER_HOST}:{SERVER_PORT}/agui"
diff --git a/services/avatar-ui/server/src/diary_service.py b/services/avatar-ui/server/src/diary_service.py
new file mode 100644
index 0000000000000000000000000000000000000000..f9571685a7e5c153ea02b67044185d3a5e9aa318
--- /dev/null
+++ b/services/avatar-ui/server/src/diary_service.py
@@ -0,0 +1,248 @@
+import json
+import logging
+import re
+import uuid
+from dataclasses import dataclass
+from datetime import datetime, timezone
+from typing import Any
+
+from google import genai
+
+from src import config
+from src.minirag_client import MiniRagClient, MiniRagConfig, MiniRagError
+
+
+logger = logging.getLogger(__name__)
+
+
+class DiaryValidationError(ValueError):
+    pass
+
+
+class DiaryAnalysisError(RuntimeError):
+    pass
+
+
+@dataclass(frozen=True)
+class SearchSettings:
+    enabled: bool
+    top_k: int
+
+
+@dataclass(frozen=True)
+class DiaryAnalysis:
+    title: str
+    importance_score: int
+    summary: str
+    semantic_memory: str
+    episodic_memory: str
+
+
+_MINIRAG_CLIENT = MiniRagClient(
+    MiniRagConfig(
+        base_url=config.MINIRAG_BASE_URL,
+        workspace=config.MINIRAG_WORKSPACE,
+    )
+)
+
+_search_settings_by_thread: dict[str, SearchSettings] = {}
+
+
+def get_search_settings(thread_id: str) -> SearchSettings:
+    return _search_settings_by_thread.get(
+        thread_id,
+        SearchSettings(
+            enabled=config.MINIRAG_SEARCH_ENABLED_DEFAULT,
+            top_k=config.MINIRAG_TOP_K_DEFAULT,
+        ),
+    )
+
+
+def set_search_settings(thread_id: str, settings: SearchSettings) -> SearchSettings:
+    clamped = SearchSettings(
+        enabled=settings.enabled,
+        top_k=max(1, min(settings.top_k, 10)),
+    )
+    _search_settings_by_thread[thread_id] = clamped
+    return clamped
+
+
+def format_transcript(messages: list[dict[str, Any]]) -> str:
+    lines: list[str] = []
+    for message in messages:
+        role = message.get("role", "user")
+        content = (message.get("content") or "").strip()
+        if not content:
+            continue
+        label = "User" if role == "user" else "Assistant" if role == "assistant" else "System"
+        lines.append(f"{label}: {content}")
+    return "\n".join(lines)
+
+
+def build_analysis_prompt(messages: list[dict[str, Any]]) -> str:
+    transcript = format_transcript(messages)
+    return (
+        "ã‚ãªãŸã¯æ—¥è¨˜ä¼šè©±ã‚’æ•´ç†ã™ã‚‹ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚"
+        "ä»¥ä¸‹ã®ä¼šè©±ã‹ã‚‰æ—¥è¨˜ã‚¿ã‚¤ãƒˆãƒ«ã€é‡è¦åº¦(1-10)ã€ã‚µãƒãƒªãƒ¼ã€"
+        "ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯è¨˜æ†¶ã€ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚"
+        "å¿…ãš JSON ã®ã¿ã‚’è¿”ã—ã€ã‚­ãƒ¼ã¯æ¬¡ã®é€šã‚Šã«ã™ã‚‹ã“ã¨:\n"
+        "title, importance_score, summary, semantic_memory, episodic_memory\n\n"
+        "ä¼šè©±:\n"
+        f"{transcript}"
+    )
+
+
+def _extract_response_text(response: Any) -> str:
+    text = getattr(response, "text", None)
+    if isinstance(text, str):
+        return text
+    candidates = getattr(response, "candidates", None)
+    if candidates:
+        content = getattr(candidates[0], "content", None)
+        parts = getattr(content, "parts", None) if content else None
+        if parts and hasattr(parts[0], "text"):
+            return parts[0].text
+    return ""
+
+
+def _extract_json_payload(text: str) -> dict[str, Any]:
+    match = re.search(r"\{.*\}", text, re.DOTALL)
+    if not match:
+        raise DiaryAnalysisError("Gemini response did not include JSON payload.")
+    try:
+        return json.loads(match.group(0))
+    except json.JSONDecodeError as exc:
+        raise DiaryAnalysisError(f"Failed to parse JSON payload: {exc}") from exc
+
+
+async def analyze_diary(messages: list[dict[str, Any]]) -> DiaryAnalysis:
+    if not messages:
+        raise DiaryValidationError("No messages provided for diary analysis.")
+    prompt = build_analysis_prompt(messages)
+    client = genai.Client(api_key=config.GOOGLE_API_KEY)
+    response = client.models.generate_content(
+        model=config.LLM_MODEL,
+        contents=prompt,
+    )
+    text = _extract_response_text(response)
+    if not text:
+        raise DiaryAnalysisError("Gemini response was empty.")
+    payload = _extract_json_payload(text)
+    try:
+        importance_score = int(payload["importance_score"])
+    except (KeyError, ValueError, TypeError) as exc:
+        raise DiaryAnalysisError("importance_score is missing or invalid.") from exc
+    return DiaryAnalysis(
+        title=str(payload.get("title", "")).strip(),
+        importance_score=importance_score,
+        summary=str(payload.get("summary", "")).strip(),
+        semantic_memory=str(payload.get("semantic_memory", "")).strip(),
+        episodic_memory=str(payload.get("episodic_memory", "")).strip(),
+    )
+
+
+def _generate_doc_id(now: datetime) -> str:
+    short_id = uuid.uuid4().hex[:8]
+    return f"journal-{now.strftime('%Y%m%d-%H%M%S')}-{short_id}"
+
+
+def build_diary_document(
+    *,
+    messages: list[dict[str, Any]],
+    analysis: DiaryAnalysis,
+    thread_id: str,
+    search_settings: SearchSettings,
+) -> dict[str, Any]:
+    now = datetime.now(timezone.utc)
+    transcript = format_transcript(messages)
+    body = "\n\n".join(
+        [
+            "## Conversation",
+            transcript,
+            "## Semantic Memory",
+            analysis.semantic_memory,
+            "## Episodic Memory",
+            analysis.episodic_memory,
+        ]
+    )
+    return {
+        "workspace": config.MINIRAG_WORKSPACE,
+        "doc_id": _generate_doc_id(now),
+        "title": analysis.title,
+        "summary": analysis.summary,
+        "body": body,
+        "importance_score": analysis.importance_score,
+        "semantic_memory": analysis.semantic_memory,
+        "episodic_memory": analysis.episodic_memory,
+        "created_at": now.isoformat(),
+        "metadata": {
+            "model": config.LLM_MODEL,
+            "message_count": len(messages),
+            "search_enabled": search_settings.enabled,
+            "top_k": search_settings.top_k,
+            "thread_id": thread_id,
+        },
+    }
+
+
+async def finalize_diary(
+    *,
+    messages: list[dict[str, Any]],
+    thread_id: str,
+    search_settings: SearchSettings,
+) -> tuple[str, int, DiaryAnalysis]:
+    analysis = await analyze_diary(messages)
+    document = build_diary_document(
+        messages=messages,
+        analysis=analysis,
+        thread_id=thread_id,
+        search_settings=search_settings,
+    )
+    try:
+        result = await _MINIRAG_CLIENT.bulk_insert([document])
+    except MiniRagError as exc:
+        raise DiaryAnalysisError(f"MiniRAG bulk insert failed: {exc}") from exc
+    inserted = int(result.get("inserted", 1))
+    return document["doc_id"], inserted, analysis
+
+
+def _extract_search_items(payload: dict[str, Any]) -> list[dict[str, Any]]:
+    candidates = (
+        payload.get("items")
+        or payload.get("results")
+        or payload.get("documents")
+        or []
+    )
+    items: list[dict[str, Any]] = []
+    for entry in candidates:
+        if not isinstance(entry, dict):
+            continue
+        items.append(
+            {
+                "doc_id": entry.get("doc_id") or entry.get("id") or "",
+                "summary": entry.get("summary") or "",
+                "body": entry.get("body") or "",
+            }
+        )
+    return items
+
+
+async def search_diary(
+    *,
+    query: str,
+    thread_id: str,
+    top_k: int | None = None,
+) -> dict[str, Any]:
+    settings = get_search_settings(thread_id)
+    if not settings.enabled:
+        return {"items": [], "disabled": True}
+    query = query.strip()
+    if not query:
+        raise DiaryValidationError("Search query is empty.")
+    effective_top_k = top_k if top_k is not None else settings.top_k
+    try:
+        payload = await _MINIRAG_CLIENT.search(query, effective_top_k)
+    except MiniRagError as exc:
+        logger.warning("MiniRAG search failed: %s", exc)
+        return {"items": [], "error": "MiniRAG unavailable"}
+    return {"items": _extract_search_items(payload)}
diff --git a/services/avatar-ui/server/src/minirag_client.py b/services/avatar-ui/server/src/minirag_client.py
new file mode 100644
index 0000000000000000000000000000000000000000..4a6c6c433b587b98a4a8b6b82e95df8fcb7a59b5
--- /dev/null
+++ b/services/avatar-ui/server/src/minirag_client.py
@@ -0,0 +1,54 @@
+import logging
+from dataclasses import dataclass
+from typing import Any
+
+import aiohttp
+
+
+logger = logging.getLogger(__name__)
+
+
+class MiniRagError(RuntimeError):
+    pass
+
+
+@dataclass(frozen=True)
+class MiniRagConfig:
+    base_url: str
+    workspace: str
+    timeout_seconds: int = 30
+
+
+class MiniRagClient:
+    def __init__(self, config: MiniRagConfig) -> None:
+        self._config = config
+        self._base_url = config.base_url.rstrip("/")
+
+    async def bulk_insert(self, documents: list[dict[str, Any]]) -> dict[str, Any]:
+        payload = {
+            "workspace": self._config.workspace,
+            "documents": documents,
+        }
+        return await self._post("/minirag/documents/bulk", payload)
+
+    async def search(self, query: str, top_k: int) -> dict[str, Any]:
+        payload = {
+            "workspace": self._config.workspace,
+            "query": query,
+            "top_k": top_k,
+        }
+        return await self._post("/minirag/search", payload)
+
+    async def _post(self, path: str, payload: dict[str, Any]) -> dict[str, Any]:
+        url = f"{self._base_url}{path}"
+        timeout = aiohttp.ClientTimeout(total=self._config.timeout_seconds)
+        try:
+            async with aiohttp.ClientSession(timeout=timeout) as session:
+                async with session.post(url, json=payload) as response:
+                    if response.status >= 400:
+                        text = await response.text()
+                        raise MiniRagError(f"MiniRAG error {response.status}: {text}")
+                    return await response.json()
+        except aiohttp.ClientError as exc:
+            logger.exception("MiniRAG request failed: %s", exc)
+            raise MiniRagError(f"MiniRAG request failed: {exc}") from exc
diff --git a/services/avatar-ui/server/src/routes/__init__.py b/services/avatar-ui/server/src/routes/__init__.py
new file mode 100644
index 0000000000000000000000000000000000000000..8b137891791fe96927ad78e64b0aad7bded08bdc
--- /dev/null
+++ b/services/avatar-ui/server/src/routes/__init__.py
@@ -0,0 +1 @@
+
diff --git a/services/avatar-ui/server/src/routes/diary.py b/services/avatar-ui/server/src/routes/diary.py
new file mode 100644
index 0000000000000000000000000000000000000000..a08c9b9133b00c9f4f3b938f26fcae16de14590d
--- /dev/null
+++ b/services/avatar-ui/server/src/routes/diary.py
@@ -0,0 +1,139 @@
+from datetime import datetime
+from typing import Literal
+
+from fastapi import APIRouter, HTTPException, status
+from pydantic import BaseModel, Field
+
+from src import config
+from src.diary_service import (
+    DiaryAnalysisError,
+    DiaryValidationError,
+    SearchSettings,
+    finalize_diary,
+    search_diary as run_search_diary,
+    set_search_settings,
+)
+
+
+router = APIRouter()
+
+
+class DiaryMessage(BaseModel):
+    role: Literal["user", "assistant", "system"]
+    content: str
+    created_at: datetime | None = None
+
+
+class SearchSettingsModel(BaseModel):
+    enabled: bool
+    top_k: int = Field(ge=1, le=10)
+
+
+class DiaryAnalysisModel(BaseModel):
+    title: str
+    importance_score: int = Field(ge=1, le=10)
+    summary: str
+    semantic_memory: str
+    episodic_memory: str
+
+
+class FinalizeDiaryRequest(BaseModel):
+    workspace: str
+    thread_id: str
+    messages: list[DiaryMessage]
+    search_settings: SearchSettingsModel
+
+
+class FinalizeDiaryResponse(BaseModel):
+    doc_id: str
+    inserted: int
+    analysis: DiaryAnalysisModel
+
+
+class SearchSettingsRequest(BaseModel):
+    thread_id: str
+    settings: SearchSettingsModel
+
+
+class SearchSettingsResponse(BaseModel):
+    applied: bool
+
+
+class ErrorResponse(BaseModel):
+    message: str
+
+
+@router.post(
+    "/agui/diary/finalize",
+    response_model=FinalizeDiaryResponse,
+    responses={
+        400: {"model": ErrorResponse},
+        503: {"model": ErrorResponse},
+    },
+)
+async def finalize_diary_route(request: FinalizeDiaryRequest) -> FinalizeDiaryResponse:
+    if request.workspace != config.MINIRAG_WORKSPACE:
+        raise HTTPException(
+            status_code=status.HTTP_400_BAD_REQUEST,
+            detail="Invalid workspace.",
+        )
+    settings = SearchSettings(
+        enabled=request.search_settings.enabled,
+        top_k=request.search_settings.top_k,
+    )
+    set_search_settings(request.thread_id, settings)
+    try:
+        doc_id, inserted, analysis = await finalize_diary(
+            messages=[message.model_dump() for message in request.messages],
+            thread_id=request.thread_id,
+            search_settings=settings,
+        )
+    except DiaryValidationError as exc:
+        raise HTTPException(
+            status_code=status.HTTP_400_BAD_REQUEST,
+            detail=str(exc),
+        ) from exc
+    except DiaryAnalysisError as exc:
+        raise HTTPException(
+            status_code=status.HTTP_503_SERVICE_UNAVAILABLE,
+            detail=str(exc),
+        ) from exc
+
+    return FinalizeDiaryResponse(
+        doc_id=doc_id,
+        inserted=inserted,
+        analysis=DiaryAnalysisModel(
+            title=analysis.title,
+            importance_score=analysis.importance_score,
+            summary=analysis.summary,
+            semantic_memory=analysis.semantic_memory,
+            episodic_memory=analysis.episodic_memory,
+        ),
+    )
+
+
+@router.post(
+    "/agui/diary/search-settings",
+    response_model=SearchSettingsResponse,
+    responses={400: {"model": ErrorResponse}},
+)
+async def update_search_settings(request: SearchSettingsRequest) -> SearchSettingsResponse:
+    settings = SearchSettings(
+        enabled=request.settings.enabled,
+        top_k=request.settings.top_k,
+    )
+    set_search_settings(request.thread_id, settings)
+    return SearchSettingsResponse(applied=True)
+
+
+async def search_diary(
+    query: str,
+    thread_id: str | None = None,
+    top_k: int | None = None,
+) -> dict:
+    """Search past diary entries and return doc_id/summary/body items."""
+    thread = thread_id or config.THREAD_ID
+    try:
+        return await run_search_diary(query=query, thread_id=thread, top_k=top_k)
+    except DiaryValidationError as exc:
+        return {"items": [], "error": str(exc)}
diff --git a/services/avatar-ui/settings.default.json5 b/services/avatar-ui/settings.default.json5
new file mode 100644
index 0000000000000000000000000000000000000000..f5f5ef520bcc5f62b9df2367ee544dcbe401a109
--- /dev/null
+++ b/services/avatar-ui/settings.default.json5
@@ -0,0 +1,43 @@
+{
+  server: {
+    llmProvider: "gemini",
+    llmModel: "gemini-2.5-flash",
+    searchSubAgent: {
+      enabled: true,
+      model: "gemini-2.5-flash",
+    },
+    systemPrompt: "ã‚ãªãŸã¯æ—¥è¨˜ä¼šè©±ã‚’æ”¯æ´ã™ã‚‹ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéå»ã®æ—¥è¨˜ã«é–¢ã™ã‚‹è³ªå•ã‚’ã—ãŸã‚Šæ–‡è„ˆãŒå¿…è¦ãªã¨ãã®ã¿ search_diary ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã„ã€å¾—ã‚‰ã‚ŒãŸ doc_id/summary/body ã‚’å‚è€ƒã«å›ç­”ã—ã¦ãã ã•ã„ã€‚æ¤œç´¢ãƒˆã‚°ãƒ«ãŒ OFF ã®å ´åˆã¯ search_diary ãŒç©ºã‚’è¿”ã™ãŸã‚ã€ç„¡ç†ã«æ¤œç´¢ã—ãªã„ã§ãã ã•ã„ã€‚",
+    logMaxBytes: 1048576,
+    logBackupCount: 3,
+  },
+  ui: {
+    typeSpeed: 0,
+    opacity: 0.7,
+    soundVolume: 0,
+    mouthInterval: 0,
+    beepFrequency: 0,
+    beepDuration: 0,
+    beepVolumeEnd: 0,
+    avatarOverlayOpacity: 0.4,
+    avatarBrightness: 1,
+    glowText: 1,
+    glowBox: 1,
+    brightness: 1,
+    nameTags: {
+      user: "YOU",
+      avatar: "SPECTRA",
+      avatarFullName: "Spectra",
+    },
+    systemMessages: {
+      banner1: "{avatarFullName} online.",
+      banner2: "Type a message to begin.",
+    },
+    theme: "classic",
+  },
+  minirag: {
+    baseUrl: "http://localhost:8165",
+    workspace: "diary",
+    searchEnabledDefault: true,
+    topKDefault: 3,
+  },
+}
